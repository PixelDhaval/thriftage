import{r as l,m as B,j as e,a as w}from"./app-C6wr7xOM.js";import{A as P}from"./async-select-DfMe9Orv.js";import{B as K,t as u}from"./index-ByhlrBJ7.js";import{f as X}from"./dialog-Dune_8vQ.js";import{I as z}from"./input-3tYqWR7g.js";import{L as m}from"./label-C16cjRI5.js";import{T as H}from"./textarea-C-bcnIPy.js";import{S as D,a as O,b as T,c as A,d as L}from"./select-Kz6bl7S3.js";import"./index-CdYzvuDs.js";import"./index-CrXPg-Qx.js";import"./check-Dpvvyly-.js";function ne({item:s,onSuccess:_}){var C,I,W;const[R,S]=l.useState(!1),[y,k]=l.useState([]),[f,N]=l.useState([]),{data:c,setData:n,errors:d,setError:U,clearErrors:V}=B({name:s.name,section_id:((C=s.section_id)==null?void 0:C.toString())||"",grade_id:((I=s.grade_id)==null?void 0:I.toString())||"",default_weight_id:((W=s.default_weight_id)==null?void 0:W.toString())||"",description:s.description||""}),[r,v]=l.useState(null),[J,b]=l.useState(null),[E,g]=l.useState(null),[j,F]=l.useState(!0);l.useEffect(()=>{var i,a,o,h,p;n({name:s.name,section_id:((i=s.section_id)==null?void 0:i.toString())||"",grade_id:((a=s.grade_id)==null?void 0:a.toString())||"",default_weight_id:((o=s.default_weight_id)==null?void 0:o.toString())||"",description:s.description||""}),s.section&&v({id:s.section_id||0,name:((h=s.section)==null?void 0:h.name)||"",weight_type:((p=s.section)==null?void 0:p.weight_type)||"kg"}),(async()=>{try{const x=await w.get("/api/grades");if(k(x.data),s.grade_id){const G=x.data.find(q=>q.id===s.grade_id);G&&b(G)}}catch(x){console.error("Error fetching grades:",x),u.error("Failed to load grades.")}})(),F(!0)},[s]),l.useEffect(()=>{r?(async()=>{try{const i=await w.get("/api/weights/select",{params:{weight_type:r.weight_type}});if(N(i.data),j&&s.default_weight_id){const a=i.data.find(o=>o.id===s.default_weight_id);a?g(a):(g(null),n("default_weight_id","")),F(!1)}else!j&&E&&E.weight_type!==r.weight_type&&(g(null),n("default_weight_id",""))}catch(i){console.error("Error fetching weights:",i),u.error("Failed to load weights for this section.")}})():(N([]),j||(g(null),n("default_weight_id","")))},[r]);const $=async t=>{var i,a;t.preventDefault(),V(),S(!0);try{const o=await w.put(`/items/${s.id}`,c,{headers:{"X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||"","Content-Type":"application/json",Accept:"application/json"}});u.success("Item updated successfully!"),_==null||_()}catch(o){if(console.error("Error updating item:",o),((a=o.response)==null?void 0:a.status)===422){const h=o.response.data.errors;Object.keys(h).forEach(p=>{U(p,h[p][0])}),u.error("Please check the form for errors.")}else u.error("Failed to update item. Please try again later.")}finally{S(!1)}};return e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"name",children:"Name"}),e.jsx(z,{id:"name",value:c.name,onChange:t=>n("name",t.target.value),required:!0}),d.name&&e.jsx("p",{className:"text-destructive text-sm",children:d.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"section_id",children:"Section"}),e.jsx(P,{route:"/api/sections/select",value:r,onChange:t=>{n("section_id",t.id.toString()),v(t)},renderOption:t=>`${t.name} (${t.weight_type.toUpperCase()})`,renderSelected:t=>t.name}),d.section_id&&e.jsx("p",{className:"text-destructive text-sm",children:d.section_id}),r&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Weight type: ",e.jsx("span",{className:"font-medium",children:r.weight_type.toUpperCase()})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"grade_id",children:"Grade"}),e.jsxs(D,{value:c.grade_id,onValueChange:t=>{n("grade_id",t);const i=y.find(a=>a.id.toString()===t);b(i||null)},children:[e.jsx(O,{children:e.jsx(T,{placeholder:"Select grade"})}),e.jsx(A,{children:y.map(t=>e.jsx(L,{value:t.id.toString(),children:t.name},t.id))})]}),d.grade_id&&e.jsx("p",{className:"text-destructive text-sm",children:d.grade_id})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"default_weight_id",children:"Default Weight (Optional)"}),e.jsxs(D,{value:c.default_weight_id,onValueChange:t=>{n("default_weight_id",t);const i=f.find(a=>a.id.toString()===t);g(i||null)},disabled:!r||f.length===0,children:[e.jsx(O,{children:e.jsx(T,{placeholder:r?"Select default weight":"Select a section first"})}),e.jsx(A,{children:f.map(t=>e.jsxs(L,{value:t.id.toString(),children:[t.weight," ",t.weight_type]},t.id))})]}),d.default_weight_id&&e.jsx("p",{className:"text-destructive text-sm",children:d.default_weight_id}),r?f.length===0?e.jsxs("p",{className:"text-sm text-amber-500",children:["No weights found for ",r.weight_type," weight type"]}):e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Optional default weight for this item (",r.weight_type," weight type)"]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a section first to see compatible weights"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(H,{id:"description",value:c.description||"",onChange:t=>n("description",t.target.value),rows:3}),d.description&&e.jsx("p",{className:"text-destructive text-sm",children:d.description})]})]}),e.jsx(X,{children:e.jsx(K,{type:"submit",disabled:R,children:"Update Item"})})]})}export{ne as default};
