import{K as L,r as l,j as e,L as E}from"./app-DblnoUo9.js";import{B as g,t as j}from"./index-CtjZe5nG.js";import{D as y}from"./data-table-BFh0cQM5.js";import{I as _}from"./input-BgtC-TtO.js";import{L as N}from"./label-1EsIaW-j.js";import{T as O,a as U,b as w,c as v}from"./tabs-Bh_7nu-6.js";import{A as q}from"./app-layout-DYw3HZaq.js";import A from"./CreateGradedBagPoolForm-BQVisOTF.js";import Q from"./GradedBagsGroupDetailDialog-DbeAXV-z.js";import{p as R}from"./printGradedBarcodes-C3FhjNQE.js";import{P as V}from"./plus-DOTxM3DS.js";import{P as W}from"./printer-CMoWhVfS.js";import{f as n}from"./format-CiT9Q78D.js";import"./select-DV1MXlmg.js";import"./floating-ui.dom-CGtuGdiq.js";import"./index-B3JiuUVX.js";import"./check-mmelet4b.js";import"./chevrons-up-down-CoxMnMnk.js";import"./chevron-left-C7TwttLF.js";import"./chevron-right-DsF4hqHw.js";import"./dialog-SbzVe55u.js";import"./index-DOebTmJq.js";import"./progress-BaReZoRY.js";import"./app-logo-icon-DW7AYQOI.js";import"./index-B0GQaYdd.js";import"./async-select-0Ekb5-3M.js";const $=[{title:"Graded Bags Pool",href:"/graded-bags-pools"}];function je(){const m=L().props.auth,D=(m==null?void 0:m.permissions)||[],[k,o]=l.useState(!1),[S,h]=l.useState(!1),[d,p]=l.useState(null),c=n(new Date,"yyyy-MM-dd"),[i,u]=l.useState({from_created_date:c,to_created_date:c}),x=(a,t)=>{u(r=>({...r,[a]:t}))},C=()=>{u({from_created_date:c,to_created_date:c})};l.useEffect(()=>{const a=t=>{t.ctrlKey&&t.key==="o"&&(t.preventDefault(),o(!0))};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[]);const G=async a=>{var t,r,s,f,b;try{await R({bags:[a],partyName:"Graded Items",weightValue:((t=a.weight)==null?void 0:t.weight)||"Unknown",itemName:((r=a.item)==null?void 0:r.name)||"Unknown",itemSection:(f=(s=a.item)==null?void 0:s.section)==null?void 0:f.name,gradeName:((b=a.grade)==null?void 0:b.name)||"Unknown",isSingle:!0}),j.success(`Print initiated for graded barcode ${a.barcode}.`)}catch(B){console.error("Error printing graded barcode:",B),j.error("Failed to print graded barcode.")}},P=a=>{var t,r,s;p({item_id:a.item_id,grade_id:a.grade_id,weight_id:a.weight_id,created_date:a.created_date,itemName:((t=a.item)==null?void 0:t.name)||"Unknown",gradeName:((r=a.grade)==null?void 0:r.name)||"Unknown",weightValue:((s=a.weight)==null?void 0:s.weight)||"Unknown",totalQuantity:a.total_quantity}),h(!0)},T=[{label:"Barcode",key:"barcode"},{label:"Item",key:"item.name"},{label:"Grade",key:"grade.name"},{label:"Weight",key:"weight.weight"},{label:"Created At",key:"created_at"}],I=[{id:"barcode",header:"Barcode",enableSorting:!0,cell:({row:a})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-mono text-sm font-medium",children:a.original.barcode})})},{id:"item",header:"Item",enableSorting:!0,cell:({row:a})=>{var t,r,s;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:((t=a.original.item)==null?void 0:t.name)||"-"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",((s=(r=a.original.item)==null?void 0:r.section)==null?void 0:s.name)||"No Section",")"]})]})}},{id:"grade",header:"Grade",enableSorting:!0,cell:({row:a})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((t=a.original.grade)==null?void 0:t.name)||"-"})})}},{id:"weight",header:"Weight",enableSorting:!0,cell:({row:a})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:[((t=a.original.weight)==null?void 0:t.weight)||"-"," kg"]})})}},{id:"created_at",header:"Created At",enableSorting:!0,cell:({row:a})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:n(new Date(a.original.created_at),"dd/MM/yyyy HH:mm")})})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:a})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(g,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),G(a.original)},className:"h-8 px-2",title:"Print this graded barcode label",children:[e.jsx(W,{className:"mr-1 h-3 w-3"}),"Print"]})})}],M=[{label:"Item",key:"item.name"},{label:"Grade",key:"grade.name"},{label:"Weight",key:"weight.weight"},{label:"Created Date",key:"created_date"},{label:"Total Quantity",key:"total_quantity"}],F=[{id:"item",header:"Item",enableSorting:!0,cell:({row:a})=>{var t,r,s;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:((t=a.original.item)==null?void 0:t.name)||"-"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",((s=(r=a.original.item)==null?void 0:r.section)==null?void 0:s.name)||"No Section",")"]})]})}},{id:"grade",header:"Grade",enableSorting:!0,cell:({row:a})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((t=a.original.grade)==null?void 0:t.name)||"-"})})}},{id:"weight",header:"Weight",enableSorting:!0,cell:({row:a})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:[((t=a.original.weight)==null?void 0:t.weight)||"-"," kg"]})})}},{id:"total_quantity",header:"Total Quantity",enableSorting:!0,cell:({row:a})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-semibold",children:a.original.total_quantity})})},{id:"total_weight",header:"Total Weight",enableSorting:!1,cell:({row:a})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"font-semibold",children:[(a.original.total_quantity*parseFloat(((t=a.original.weight)==null?void 0:t.weight)||"0")).toFixed(2)," kg"]})})}},{id:"created_date",header:"Created Date",enableSorting:!0,cell:({row:a})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:n(new Date(a.original.created_date),"dd/MM/yyyy")})})}];return e.jsxs(q,{breadcrumbs:$,children:[e.jsx(E,{title:"Graded Bags Pool"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Graded Bags Pool"}),e.jsxs("p",{className:"text-muted-foreground",children:["Press ",e.jsx("kbd",{className:"bg-muted rounded px-1 py-0.5 text-xs",children:"Ctrl+O"})," to create new graded bags."]})]}),D.includes("graded-bags-pools-create")&&e.jsxs(g,{onClick:()=>o(!0),className:"gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"Create Graded Bags"]})]}),e.jsxs(O,{defaultValue:"barcodes",className:"w-full",children:[e.jsxs(U,{children:[e.jsx(w,{value:"barcodes",children:"Individual Barcodes"}),e.jsx(w,{value:"grouped",children:"Grouped Summary"})]}),e.jsxs("div",{className:"bg-muted/50 mb-6 grid grid-cols-1 gap-4 rounded-lg p-4 md:grid-cols-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"from-date",children:"From Date"}),e.jsx(_,{id:"from-date",type:"date",value:i.from_created_date,onChange:a=>x("from_created_date",a.target.value),className:"w-full"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"to-date",children:"To Date"}),e.jsx(_,{id:"to-date",type:"date",value:i.to_created_date,onChange:a=>x("to_created_date",a.target.value),className:"w-full"})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsx(g,{variant:"outline",onClick:C,className:"h-10",title:"Reset to today's date",children:"Reset to Today"})}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing data from ",n(new Date(i.from_created_date),"dd/MM/yyyy")," to ",n(new Date(i.to_created_date),"dd/MM/yyyy")]})})]}),e.jsx(v,{value:"barcodes",children:e.jsx(y,{filterableColumns:T,route:"/api/graded-bags-pools-with-barcodes",columns:I,pageSize:20,params:i},`barcodes-${i.from_created_date}-${i.to_created_date}`)}),e.jsx(v,{value:"grouped",children:e.jsx(y,{filterableColumns:M,route:"/api/graded-bags-pools",columns:F,pageSize:20,onEdit:P,params:i},`grouped-${i.from_created_date}-${i.to_created_date}`)})]}),e.jsx(A,{isOpen:k,onClose:()=>o(!1),onSuccess:()=>{var a;o(!1),(a=window.refreshDataTable)==null||a.call(window)}}),d&&e.jsx(Q,{isOpen:S,onClose:()=>{h(!1),p(null)},item_id:d.item_id,grade_id:d.grade_id,weight_id:d.weight_id,created_date:d.created_date,itemName:d.itemName,gradeName:d.gradeName,weightValue:d.weightValue,totalQuantity:d.totalQuantity})]})]})}export{je as default};
