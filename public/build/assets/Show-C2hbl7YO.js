import{j as e,r as n,L as oe,a as W}from"./app-CtuGzTD0.js";import{A as ce}from"./async-select-B3KHCtph.js";import{c as ge,a as m,B as l,t as c}from"./index-DTz_dOKf.js";import{D as M}from"./data-table-DkScS0uD.js";import{D as b,a as f,b as y,c as N,d as w,e as _}from"./dialog-se0ddr7h.js";import{L}from"./label-BSxjy5Yj.js";import{S as he,a as me,b as xe,c as pe,d as U}from"./select-ICR_PJ75.js";import{T as ue,a as je,b as V,c as $}from"./tabs-aXC0ueYD.js";import{A as be}from"./app-layout-BGB8rSsi.js";import{P as z,p as G}from"./printBarcodes-B8SpWLrn.js";import H from"./AddImportBagForm-MPyxbuI6.js";import fe from"./EditImportForm-BmA9j0j8.js";import ye from"./ImportBagsWithBarcodesDialog-BugtM8nJ.js";import{P as R}from"./plus-CoZ06UYG.js";import{f as h}from"./format-CBpsKyOP.js";import"./floating-ui.dom-C5vApqfE.js";import"./input-BpOFhh0X.js";import"./floating-ui.react-dom-Hweb9cg9.js";import"./chevrons-up-down-XS2XNHAR.js";import"./index-DIEkADUd.js";import"./check-CV9dr0FE.js";import"./circle-alert-BI0BowhV.js";import"./app-logo-icon-cW5t1vWh.js";import"./index-DKi30mk3.js";import"./delete-confirmation-dialog-w5s5G8yj.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],we=ge("SquarePen",Ne);function v({className:t,...i}){return e.jsx("div",{"data-slot":"card",className:m("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...i})}function S({className:t,...i}){return e.jsx("div",{"data-slot":"card-header",className:m("flex flex-col gap-1.5 px-6",t),...i})}function B({className:t,...i}){return e.jsx("div",{"data-slot":"card-title",className:m("leading-none font-semibold",t),...i})}function A({className:t,...i}){return e.jsx("div",{"data-slot":"card-content",className:m("px-6",t),...i})}function Ke({import:t}){var F,T,O,E;const[i,C]=n.useState(!1),[q,I]=n.useState(!1),[J,k]=n.useState(!1),[K,x]=n.useState(!1),[d,p]=n.useState(null),Q=[{title:"Imports Management",href:"/imports"},{title:(t.type=="container"?t.container_no:(F=t.party)==null?void 0:F.name)||"N/A",href:"#"}],[g,u]=n.useState({import_id:t.id,party_id:"",weight_id:""}),[X,P]=n.useState(null),[Y,Z]=n.useState([]);n.useEffect(()=>{(async()=>{try{const a=await W.get("/api/weights");Z(a.data)}catch(a){console.error("Error fetching weights:",a)}})()},[]);const D=s=>{P(s),u(a=>({...a,party_id:(s==null?void 0:s.id)||""}))},ee=s=>{u(a=>({...a,weight_id:s}))},se=()=>{P(null),u({import_id:t.id,party_id:"",weight_id:""})},te=s=>{var a,r;p({importId:t.id,partyId:s.original.party_id,weightId:s.original.weight_id,partyName:((a=s.original.party)==null?void 0:a.name)||"Unknown",weightValue:((r=s.original.weight)==null?void 0:r.weight)||"Unknown"}),x(!0)},ae=async s=>{var a,r;try{const o=await W.get("/api/import-bags-with-barcodes",{params:{import_id:t.id,party_id:s.original.party_id,weight_id:s.original.weight_id}}),j=o.data.data||o.data;if(j.length===0){c.error("No bags found to print.");return}await G({bags:j,partyName:((a=s.original.party)==null?void 0:a.name)||"Unknown",containerNo:t.container_no,movementDate:t.movement_date,weightValue:((r=s.original.weight)==null?void 0:r.weight)||"Unknown"}),c.success(`Print initiated for ${j.length} barcodes.`)}catch(o){console.error("Error fetching bags for printing:",o),c.error("Failed to fetch bags for printing.")}},re=async s=>{var a,r;try{await G({bags:[s],partyName:((a=s.party)==null?void 0:a.name)||"Unknown",containerNo:t.container_no,movementDate:t.movement_date,weightValue:((r=s.weight)==null?void 0:r.weight)||"Unknown",isSingle:!0}),c.success(`Print initiated for barcode ${s.barcode}.`)}catch(o){console.error("Error printing barcode:",o),c.error("Failed to print barcode.")}},ie=[{label:"Party",key:"party.name"},{label:"Weight",key:"weight"},{label:"Status",key:"status"}],ne=[...t.type==="container"?[{id:"party",header:"Party",enableSorting:!0,cell:({row:s})=>{var a;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((a=s.original.party)==null?void 0:a.name)||"-"})})}}]:[],{id:"weight",header:"Weight",enableSorting:!0,cell:({row:s})=>{var a;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:[((a=s.original.weight)==null?void 0:a.weight)||"-"," kg"]})})}},{id:"bag_count",header:"Bag Count",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(l,{variant:"link",className:"h-auto p-0 font-semibold text-blue-600",onClick:()=>te(s),children:s.original.bag_count||0})})},{id:"opened_count",header:"Opened",enableSorting:!1,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-green-600",children:s.original.opened_count||0})})},{id:"unopened_count",header:"Unopened",enableSorting:!1,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-red-600",children:s.original.unopened_count||0})})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:a=>{a.stopPropagation(),ae(s)},className:"h-8 px-2",title:"Print all barcodes for this party and weight",children:[e.jsx(z,{className:"mr-1 h-3 w-3"}),"Print All"]})})}],le=[{label:"Barcode",key:"barcode"},{label:"Party",key:"party.name"},{label:"Weight",key:"weight"},{label:"Status",key:"status"},{label:"Created At",key:"created_at"}],de=[{id:"barcode",header:"Barcode",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-mono text-sm",children:s.original.barcode})})},...t.type==="container"?[{id:"party",header:"Party",enableSorting:!0,cell:({row:s})=>{var a;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((a=s.original.party)==null?void 0:a.name)||"-"})})}}]:[],{id:"weight",header:"Weight",enableSorting:!0,cell:({row:s})=>{var a;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:[((a=s.original.weight)==null?void 0:a.weight)||"-"," kg"]})})}},{id:"status",header:"Status",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`rounded-full px-2 py-1 text-xs ${s.original.status==="opened"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.original.status})})},{id:"created_at",header:"Created At",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:h(s.original.created_at,"dd/MM/yyyy")})})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:a=>{a.stopPropagation(),re(s.original)},className:"h-8 px-2",title:"Print this barcode label",children:[e.jsx(z,{className:"mr-1 h-3 w-3"}),"Print"]})})}];return e.jsxs(be,{breadcrumbs:Q,children:[e.jsx(oe,{title:`Import Details - ${t.type=="container"?t.container_no:((T=t.party)==null?void 0:T.name)||"N/A"}`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs(v,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between",children:[e.jsx(B,{children:"Import Details"}),e.jsxs(b,{open:i,onOpenChange:C,children:[e.jsx(f,{asChild:!0,children:e.jsxs(l,{variant:"outline",size:"sm",children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Edit Import"]})}),e.jsxs(y,{children:[e.jsxs(N,{children:[e.jsx(w,{children:"Edit Import"}),e.jsx(_,{children:"Update import details."})]}),e.jsx(fe,{import:t,onSuccess:()=>{C(!1),window.location.reload()}})]})]})]}),e.jsx(A,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"Party Information"}),e.jsx("p",{className:"text-lg font-medium",children:((O=t.party)==null?void 0:O.name)||"N/A"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:((E=t.party)==null?void 0:E.type)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:t.type==="container"?"Container Details":"Reference Details"}),e.jsx("p",{className:"text-lg font-medium",children:t.container_no||"N/A"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:t.movement_date?h(t.movement_date,"dd/MM/yyyy"):"N/A"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"Import Type"}),e.jsx("span",{className:`rounded-full px-2 py-1 text-xs ${t.type==="container"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:t.type==="container"?"Via Container":"Local Delivery"})]}),t.type==="container"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"BL Details"}),e.jsxs("p",{className:"text-sm",children:["No: ",t.bl_no||"N/A"]}),e.jsxs("p",{className:"text-sm",children:["Date: ",t.bl_date?h(t.bl_date,"dd/MM/yyyy"):"N/A"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"BE Details"}),e.jsxs("p",{className:"text-sm",children:["No: ",t.be_no||"N/A"]}),e.jsxs("p",{className:"text-sm",children:["Date: ",t.be_date?h(t.be_date,"dd/MM/yyyy"):"N/A"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"Weights"}),t.type==="container"&&e.jsxs("p",{className:"text-sm",children:["BL: ",t.bl_weight?`${t.bl_weight} kg`:"N/A"]}),e.jsxs("p",{className:"text-sm",children:[t.type==="container"?"WB:":"Total:"," ",t.weigh_bridge_weight?`${t.weigh_bridge_weight} kg`:"N/A"]})]})]})})]}),e.jsxs(ue,{defaultValue:"bags",className:"w-full",children:[e.jsxs(je,{children:[e.jsx(V,{value:"bags",children:"Import Bags"}),e.jsx(V,{value:"barcode-bags",children:"Barcode wise Bags"})]}),e.jsx($,{value:"bags",children:e.jsxs(v,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between",children:[e.jsx(B,{children:"Import Bags"}),e.jsxs(b,{open:q,onOpenChange:I,children:[e.jsx(f,{asChild:!0,children:e.jsxs(l,{children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Add Bags"]})}),e.jsxs(y,{children:[e.jsxs(N,{children:[e.jsx(w,{children:"Add Import Bags"}),e.jsx(_,{children:"Add new bags to this import."})]}),e.jsx(H,{importData:t,onSuccess:()=>{var s;I(!1),(s=window.refreshDataTable)==null||s.call(window)}})]})]})]}),e.jsx(A,{children:e.jsx(M,{filterableColumns:ie,route:"/api/import-bags",columns:ne,pageSize:20,params:{import_id:t.id},onEdit:s=>{var a,r;console.log(s),p({importId:t.id,partyId:s.party_id,weightId:s.weight_id,partyName:((a=s.party)==null?void 0:a.name)||"Unknown",weightValue:((r=s.weight)==null?void 0:r.weight)||"Unknown"}),x(!0)}})})]})}),e.jsx($,{value:"barcode-bags",children:e.jsxs(v,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between",children:[e.jsx(B,{children:"Barcode wise Bags"}),e.jsxs(b,{open:J,onOpenChange:k,children:[e.jsx(f,{asChild:!0,children:e.jsxs(l,{children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Add Import Bags"]})}),e.jsxs(y,{children:[e.jsxs(N,{children:[e.jsx(w,{children:"Add Import Bags"}),e.jsx(_,{children:"Add new bags to this import."})]}),e.jsx(H,{importData:t,onSuccess:()=>{var s;k(!1),(s=window.refreshDataTable)==null||s.call(window)}})]})]})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"bg-muted/50 mb-6 grid grid-cols-1 gap-4 rounded-lg p-4 md:grid-cols-3",children:[t.type==="container"&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"party-filter",children:"Filter by Party"}),e.jsx(ce,{route:"/api/parties/select",params:{type:"supplier"},value:X,onChange:D,placeholder:"All parties",renderOption:s=>s.name,renderSelected:s=>s.name,isClearable:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"weight-filter",children:"Filter by Weight"}),e.jsxs(he,{value:g.weight_id,onValueChange:ee,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"All weights"})}),e.jsxs(pe,{children:[e.jsx(U,{children:"All weights"}),Y.map(s=>e.jsxs(U,{value:s.id.toString(),children:[s.weight," kg"]},s.id))]})]})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsx(l,{variant:"outline",onClick:se,className:"h-10",children:"Reset Filters"})})]}),e.jsx(M,{filterableColumns:le,route:"/api/import-bags-with-barcodes",columns:de,pageSize:20,params:g},`${g.party_id}-${g.weight_id}`)]})]})})]}),d&&e.jsx(ye,{isOpen:K,onClose:()=>{x(!1),p(null)},importId:d.importId,partyId:d.partyId,weightId:d.weightId,partyName:d.partyName,weightValue:d.weightValue})]})]})}export{Ke as default};
