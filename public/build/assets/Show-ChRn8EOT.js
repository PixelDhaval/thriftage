import{j as e,r as n,L as pe,a as C}from"./app-DblnoUo9.js";import{A as ue}from"./async-select-0Ekb5-3M.js";import{a as je,c as S,B as l,t as x}from"./index-CtjZe5nG.js";import{D as P}from"./data-table-BFh0cQM5.js";import{D as j,e as b,a as f,b as y,c as N,d as w}from"./dialog-SbzVe55u.js";import{L as z}from"./label-1EsIaW-j.js";import{S as be,a as fe,b as ye,c as Ne,d as H}from"./select-DV1MXlmg.js";import{T as we,a as ve,b as k,c as O}from"./tabs-Bh_7nu-6.js";import{A as _e,P as Se}from"./app-layout-DYw3HZaq.js";import{p as R}from"./printBarcodes-WbH37XdV.js";import q from"./AddImportBagForm-D2-69nX7.js";import Be from"./EditImportForm-D3mD99NZ.js";import Ie from"./ImportBagsWithBarcodesDialog-DBAkxauR.js";import Ae from"./CreateGradedItemPoolForm-zwv_cef5.js";import{P as Q}from"./printer-CMoWhVfS.js";import{P as G}from"./plus-DOTxM3DS.js";import{f as m}from"./format-CiT9Q78D.js";import"./floating-ui.dom-CGtuGdiq.js";import"./input-BgtC-TtO.js";import"./chevrons-up-down-CoxMnMnk.js";import"./chevron-left-C7TwttLF.js";import"./chevron-right-DsF4hqHw.js";import"./index-DOebTmJq.js";import"./index-B3JiuUVX.js";import"./check-mmelet4b.js";import"./progress-BaReZoRY.js";import"./app-logo-icon-DW7AYQOI.js";import"./index-B0GQaYdd.js";import"./CreateGradedBagPoolForm-BQVisOTF.js";import"./printGradedBarcodes-C3FhjNQE.js";import"./delete-confirmation-dialog-Dn4OM_pK.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Pe=je("SquarePen",Ce);function d({className:a,...i}){return e.jsx("div",{"data-slot":"card",className:S("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...i})}function v({className:a,...i}){return e.jsx("div",{"data-slot":"card-header",className:S("flex flex-col gap-1.5 px-6",a),...i})}function _({className:a,...i}){return e.jsx("div",{"data-slot":"card-title",className:S("leading-none font-semibold",a),...i})}function c({className:a,...i}){return e.jsx("div",{"data-slot":"card-content",className:S("px-6",a),...i})}function hs({import:a}){var U,L,V,$;const[i,F]=n.useState(!1),[J,T]=n.useState(!1),[K,M]=n.useState(!1),[X,B]=n.useState(!1),[g,I]=n.useState(null),[Y,E]=n.useState(!1),[ke,Oe]=n.useState(!1),[Ge,Fe]=n.useState(null),Z=[{title:"Imports Management",href:"/imports"},{title:(a.type=="container"?a.container_no:(U=a.party)==null?void 0:U.name)||"N/A",href:"#"}],[p,A]=n.useState({import_id:a.id,party_id:"",weight_id:""}),[D,W]=n.useState(null),[ee,se]=n.useState([]),[o,ae]=n.useState(null);n.useEffect(()=>{(async()=>{try{const[t,r]=await Promise.all([C.get("/api/weights"),C.get(`/api/imports/${a.id}/stats`)]);se(t.data),ae(r.data)}catch(t){console.error("Error fetching data:",t)}})()},[a.id]);const te=s=>{W(s),A(t=>({...t,party_id:(s==null?void 0:s.id)||""}))},re=s=>{A(t=>({...t,weight_id:s}))},ne=()=>{W(null),A({import_id:a.id,party_id:"",weight_id:""})},ie=s=>{var t,r;I({importId:a.id,partyId:s.original.party_id,weightId:s.original.weight_id,partyName:((t=s.original.party)==null?void 0:t.name)||"Unknown",weightValue:((r=s.original.weight)==null?void 0:r.weight)||"Unknown"}),B(!0)},le=async s=>{var t,r;try{const h=await C.get("/api/import-bags-with-barcodes",{params:{import_id:a.id,party_id:s.original.party_id,weight_id:s.original.weight_id}}),u=h.data.data||h.data;if(u.length===0){x.error("No bags found to print.");return}await R({bags:u,partyName:((t=s.original.party)==null?void 0:t.name)||"Unknown",containerNo:a.container_no,movementDate:a.movement_date,weightValue:((r=s.original.weight)==null?void 0:r.weight)||"Unknown",totalQuantity:u.length}),x.success(`Print initiated for ${u.length} barcodes.`)}catch(h){console.error("Error fetching bags for printing:",h),x.error("Failed to fetch bags for printing.")}},de=async s=>{var t,r;try{await R({bags:[s],partyName:((t=s.party)==null?void 0:t.name)||"Unknown",containerNo:a.container_no,movementDate:a.movement_date,weightValue:((r=s.weight)==null?void 0:r.weight)||"Unknown",isSingle:!0,totalQuantity:1}),x.success(`Print initiated for barcode ${s.barcode}.`)}catch(h){console.error("Error printing barcode:",h),x.error("Failed to print barcode.")}},ce=[{label:"Party",key:"party.name"},{label:"Weight",key:"weight"},{label:"Status",key:"status"}],oe=[...a.type==="container"?[{id:"party",header:"Party",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((t=s.original.party)==null?void 0:t.name)||"-"})})}}]:[],{id:"weight",header:"Weight",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:[((t=s.original.weight)==null?void 0:t.weight)||"-"," kg"]})})}},{id:"bag_count",header:"Bag Count",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(l,{variant:"link",className:"h-auto p-0 font-semibold text-blue-600",onClick:()=>ie(s),children:s.original.bag_count||0})})},{id:"opened_count",header:"Opened",enableSorting:!1,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-green-600",children:s.original.opened_count||0})})},{id:"unopened_count",header:"Unopened",enableSorting:!1,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-red-600",children:s.original.unopened_count||0})})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),le(s)},className:"h-8 px-2",title:"Print all barcodes for this party and weight",children:[e.jsx(Q,{className:"mr-1 h-3 w-3"}),"Print All"]})})}],ge=[{label:"Barcode",key:"barcode"},{label:"Party",key:"party.name"},{label:"Weight",key:"weight"},{label:"Status",key:"status"},{label:"Created At",key:"created_at"}],he=[{id:"barcode",header:"Barcode",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-mono text-sm",children:s.original.barcode})})},...a.type==="container"?[{id:"party",header:"Party",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((t=s.original.party)==null?void 0:t.name)||"-"})})}}]:[],{id:"weight",header:"Weight",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:[((t=s.original.weight)==null?void 0:t.weight)||"-"," kg"]})})}},{id:"status",header:"Status",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`rounded-full px-2 py-1 text-xs ${s.original.status==="opened"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.original.status})})},{id:"created_at",header:"Created At",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:m(s.original.created_at,"dd/MM/yyyy")})})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),de(s.original)},className:"h-8 px-2",title:"Print this barcode label",children:[e.jsx(Q,{className:"mr-1 h-3 w-3"}),"Print"]})})}],me=[{label:"Party",key:"party.name"},{label:"Section",key:"section.name"},{label:"Grade",key:"grade.name"},{label:"Weight",key:"weight"},{label:"Graded At",key:"graded_at"}],xe=[...a.type==="container"?[{id:"party",header:"Party",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((t=s.original.party)==null?void 0:t.name)||"-"})})}}]:[],{id:"section",header:"Section",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((t=s.original.section)==null?void 0:t.name)||"-"})})}},{id:"grade",header:"Grade",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((t=s.original.grade)==null?void 0:t.name)||"-"})})}},{id:"weight",header:"Weight",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"font-semibold",children:[s.original.weight," kg"]})})},{id:"graded_at",header:"Graded At",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:m(new Date(s.original.graded_at),"dd/MM/yyyy")})})},{id:"created_at",header:"Created At",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:m(new Date(s.original.created_at),"dd/MM/yyyy HH:mm")})})}];return e.jsxs(_e,{breadcrumbs:Z,children:[e.jsx(pe,{title:`Import Details - ${a.type=="container"?a.container_no:((L=a.party)==null?void 0:L.name)||"N/A"}`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs(d,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between",children:[e.jsx(_,{children:"Import Details"}),e.jsxs(j,{open:i,onOpenChange:F,children:[e.jsx(b,{asChild:!0,children:e.jsxs(l,{variant:"outline",size:"sm",children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Edit Import"]})}),e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(N,{children:"Edit Import"}),e.jsx(w,{children:"Update import details."})]}),e.jsx(Be,{import:a,onSuccess:()=>{F(!1),window.location.reload()}})]})]})]}),e.jsx(c,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"Party Information"}),e.jsx("p",{className:"text-lg font-medium",children:((V=a.party)==null?void 0:V.name)||"N/A"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:(($=a.party)==null?void 0:$.type)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:a.type==="container"?"Container Details":"Reference Details"}),e.jsx("p",{className:"text-lg font-medium",children:a.container_no||"N/A"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:a.movement_date?m(a.movement_date,"dd/MM/yyyy"):"N/A"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"Import Type"}),e.jsx("span",{className:`rounded-full px-2 py-1 text-xs ${a.type==="container"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:a.type==="container"?"Via Container":"Local Delivery"})]}),a.type==="container"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"BL Details"}),e.jsxs("p",{className:"text-sm",children:["No: ",a.bl_no||"N/A"]}),e.jsxs("p",{className:"text-sm",children:["Date: ",a.bl_date?m(a.bl_date,"dd/MM/yyyy"):"N/A"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"BE Details"}),e.jsxs("p",{className:"text-sm",children:["No: ",a.be_no||"N/A"]}),e.jsxs("p",{className:"text-sm",children:["Date: ",a.be_date?m(a.be_date,"dd/MM/yyyy"):"N/A"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"Weights"}),a.type==="container"&&e.jsxs("p",{className:"text-sm",children:["BL: ",a.bl_weight?`${a.bl_weight} kg`:"N/A"]}),e.jsxs("p",{className:"text-sm",children:[a.type==="container"?"WB:":"Total:"," ",a.weigh_bridge_weight?`${a.weigh_bridge_weight} kg`:"N/A"]})]})]})})]}),o&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsx(d,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Bags"}),e.jsx("p",{className:"text-2xl font-bold",children:o.total_bags})]})]})})}),e.jsx(d,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-5 rounded bg-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Opened Bags"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:o.opened_bags})]})]})})}),e.jsx(d,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-5 rounded bg-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unopened Bags"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:o.unopened_bags})]})]})})}),e.jsx(d,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-5 rounded bg-amber-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Opening Progress"}),e.jsxs("p",{className:"text-2xl font-bold text-amber-600",children:[o.total_bags>0?Math.round(o.opened_bags/o.total_bags*100):0,"%"]})]})]})})})]}),e.jsxs(we,{defaultValue:"bags",className:"w-full",children:[e.jsxs(ve,{children:[e.jsx(k,{value:"bags",children:"Import Bags"}),e.jsx(k,{value:"barcode-bags",children:"Barcode wise Bags"}),e.jsx(k,{value:"grading",children:"Graded Items Pool"})]}),e.jsx(O,{value:"bags",children:e.jsxs(d,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between",children:[e.jsx(_,{children:"Import Bags"}),e.jsxs(j,{open:J,onOpenChange:T,children:[e.jsx(b,{asChild:!0,children:e.jsxs(l,{children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Add Bags"]})}),e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(N,{children:"Add Import Bags"}),e.jsx(w,{children:"Add new bags to this import."})]}),e.jsx(q,{importData:a,onSuccess:()=>{var s;T(!1),(s=window.refreshDataTable)==null||s.call(window)}})]})]})]}),e.jsx(c,{children:e.jsx(P,{filterableColumns:ce,route:"/api/import-bags",columns:oe,pageSize:20,params:{import_id:a.id},onEdit:s=>{var t,r;console.log(s),I({importId:a.id,partyId:s.party_id,weightId:s.weight_id,partyName:((t=s.party)==null?void 0:t.name)||"Unknown",weightValue:((r=s.weight)==null?void 0:r.weight)||"Unknown"}),B(!0)}})})]})}),e.jsx(O,{value:"barcode-bags",children:e.jsxs(d,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between",children:[e.jsx(_,{children:"Barcode wise Bags"}),e.jsxs(j,{open:K,onOpenChange:M,children:[e.jsx(b,{asChild:!0,children:e.jsxs(l,{children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Add Import Bags"]})}),e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(N,{children:"Add Import Bags"}),e.jsx(w,{children:"Add new bags to this import."})]}),e.jsx(q,{importData:a,onSuccess:()=>{var s;M(!1),(s=window.refreshDataTable)==null||s.call(window)}})]})]})]}),e.jsxs(c,{children:[e.jsxs("div",{className:"bg-muted/50 mb-6 grid grid-cols-1 gap-4 rounded-lg p-4 md:grid-cols-3",children:[a.type==="container"&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"party-filter",children:"Filter by Party"}),e.jsx(ue,{route:"/api/parties/select",params:{type:"supplier"},value:D,onChange:te,placeholder:"All parties",renderOption:s=>s.name,renderSelected:s=>s.name,isClearable:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"weight-filter",children:"Filter by Weight"}),e.jsxs(be,{value:p.weight_id,onValueChange:re,children:[e.jsx(fe,{children:e.jsx(ye,{placeholder:"All weights"})}),e.jsxs(Ne,{children:[e.jsx(H,{children:"All weights"}),ee.map(s=>e.jsxs(H,{value:s.id.toString(),children:[s.weight," kg"]},s.id))]})]})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsx(l,{variant:"outline",onClick:ne,className:"h-10",children:"Reset Filters"})})]}),e.jsx(P,{filterableColumns:ge,route:"/api/import-bags-with-barcodes",columns:he,pageSize:20,params:p},`${p.party_id}-${p.weight_id}`)]})]})}),e.jsx(O,{value:"grading",children:e.jsxs(d,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between",children:[e.jsx(_,{children:"Graded Items Pool"}),e.jsxs(j,{open:Y,onOpenChange:E,children:[e.jsx(b,{asChild:!0,children:e.jsxs(l,{children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Add Graded Item"]})}),e.jsxs(f,{className:"max-w-md",children:[e.jsxs(y,{children:[e.jsx(N,{children:"Add Graded Item Pool"}),e.jsx(w,{children:"Add graded item to this import."})]}),e.jsx(Ae,{importData:a,onSuccess:()=>{var s;E(!1),(s=window.refreshDataTable)==null||s.call(window)}})]})]})]}),e.jsx(c,{children:e.jsx(P,{filterableColumns:me,route:"/api/graded-items-pools",columns:xe,pageSize:20,params:{import_id:a.id}})})]})})]}),g&&e.jsx(Ie,{isOpen:X,onClose:()=>{B(!1),I(null)},importId:g.importId,partyId:g.partyId,weightId:g.weightId,partyName:g.partyName,weightValue:g.weightValue})]})]})}export{hs as default};
