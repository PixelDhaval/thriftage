import{K as G,r as n,j as a,L as P}from"./app-wUZwPzD3.js";import{B as p,t as h}from"./index-1uObsv-p.js";import{D as u}from"./data-table-nY-iRK8O.js";import{T,a as I,b as x,c as b}from"./tabs-Db3LC5ja.js";import{A as B}from"./app-layout-DQC7ZKiF.js";import E from"./CreateGradedBagPoolForm-D1ZwPEQS.js";import O from"./GradedBagsGroupDetailDialog-Djun7oGJ.js";import{p as F}from"./printGradedBarcodes-DF3k3OmZ.js";import{P as L}from"./plus-ee1U_9ef.js";import{P as U}from"./printer-CeUT-y7k.js";import{f}from"./format-CiT9Q78D.js";import"./input-Sj9AGIQ-.js";import"./select-CLmYYzS9.js";import"./floating-ui.react-dom-lVSpvGBt.js";import"./floating-ui.dom-C5vApqfE.js";import"./index-CPPfu1Tl.js";import"./check-D6HYTAg4.js";import"./chevrons-up-down-P82T7p8A.js";import"./chevron-left-DnAd4m_x.js";import"./chevron-right-BkpnjaTb.js";import"./dialog-COlZQqyY.js";import"./index-CdGjkSEY.js";import"./label-Cn97VJAf.js";import"./circle-alert-46nEhRp0.js";import"./app-logo-icon-DSA9objX.js";import"./index-BMSEjWe5.js";import"./async-select-CBohTVfG.js";import"./progress-CBd4IV_8.js";const q=[{title:"Graded Bags Pool",href:"/graded-bags-pools"}];function he(){const d=G().props.auth,j=(d==null?void 0:d.permissions)||[],[y,l]=n.useState(!1),[N,o]=n.useState(!1),[s,c]=n.useState(null);n.useEffect(()=>{const e=t=>{t.ctrlKey&&t.key==="o"&&(t.preventDefault(),l(!0))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]);const w=async e=>{var t,i,r,m,g;try{await F({bags:[e],partyName:"Graded Items",weightValue:((t=e.weight)==null?void 0:t.weight)||"Unknown",itemName:((i=e.item)==null?void 0:i.name)||"Unknown",itemSection:(m=(r=e.item)==null?void 0:r.section)==null?void 0:m.name,gradeName:((g=e.grade)==null?void 0:g.name)||"Unknown",isSingle:!0}),h.success(`Print initiated for graded barcode ${e.barcode}.`)}catch(D){console.error("Error printing graded barcode:",D),h.error("Failed to print graded barcode.")}},_=e=>{var t,i,r;c({item_id:e.item_id,grade_id:e.grade_id,weight_id:e.weight_id,created_date:e.created_date,itemName:((t=e.item)==null?void 0:t.name)||"Unknown",gradeName:((i=e.grade)==null?void 0:i.name)||"Unknown",weightValue:((r=e.weight)==null?void 0:r.weight)||"Unknown",totalQuantity:e.total_quantity}),o(!0)},k=[{label:"Barcode",key:"barcode"},{label:"Item",key:"item.name"},{label:"Grade",key:"grade.name"},{label:"Weight",key:"weight.weight"},{label:"Created At",key:"created_at"}],S=[{id:"barcode",header:"Barcode",enableSorting:!0,cell:({row:e})=>a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("span",{className:"font-mono text-sm font-medium",children:e.original.barcode})})},{id:"item",header:"Item",enableSorting:!0,cell:({row:e})=>{var t,i,r;return a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{children:((t=e.original.item)==null?void 0:t.name)||"-"}),a.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",((r=(i=e.original.item)==null?void 0:i.section)==null?void 0:r.name)||"No Section",")"]})]})}},{id:"grade",header:"Grade",enableSorting:!0,cell:({row:e})=>{var t;return a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("span",{children:((t=e.original.grade)==null?void 0:t.name)||"-"})})}},{id:"weight",header:"Weight",enableSorting:!0,cell:({row:e})=>{var t;return a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{children:[((t=e.original.weight)==null?void 0:t.weight)||"-"," kg"]})})}},{id:"created_at",header:"Created At",enableSorting:!0,cell:({row:e})=>a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("span",{children:f(new Date(e.original.created_at),"dd/MM/yyyy HH:mm")})})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:e})=>a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs(p,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),w(e.original)},className:"h-8 px-2",title:"Print this graded barcode label",children:[a.jsx(U,{className:"mr-1 h-3 w-3"}),"Print"]})})}],v=[{label:"Item",key:"item.name"},{label:"Grade",key:"grade.name"},{label:"Weight",key:"weight.weight"},{label:"Created Date",key:"created_date"},{label:"Total Quantity",key:"total_quantity"}],C=[{id:"item",header:"Item",enableSorting:!0,cell:({row:e})=>{var t,i,r;return a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{children:((t=e.original.item)==null?void 0:t.name)||"-"}),a.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",((r=(i=e.original.item)==null?void 0:i.section)==null?void 0:r.name)||"No Section",")"]})]})}},{id:"grade",header:"Grade",enableSorting:!0,cell:({row:e})=>{var t;return a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("span",{children:((t=e.original.grade)==null?void 0:t.name)||"-"})})}},{id:"weight",header:"Weight",enableSorting:!0,cell:({row:e})=>{var t;return a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{children:[((t=e.original.weight)==null?void 0:t.weight)||"-"," kg"]})})}},{id:"total_quantity",header:"Total Quantity",enableSorting:!0,cell:({row:e})=>a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("span",{className:"font-semibold",children:e.original.total_quantity})})},{id:"total_weight",header:"Total Weight",enableSorting:!1,cell:({row:e})=>{var t;return a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{className:"font-semibold",children:[(e.original.total_quantity*parseFloat(((t=e.original.weight)==null?void 0:t.weight)||"0")).toFixed(2)," kg"]})})}},{id:"created_date",header:"Created Date",enableSorting:!0,cell:({row:e})=>a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("span",{children:f(new Date(e.original.created_date),"dd/MM/yyyy")})})}];return a.jsxs(B,{breadcrumbs:q,children:[a.jsx(P,{title:"Graded Bags Pool"}),a.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[a.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-semibold",children:"Graded Bags Pool"}),a.jsxs("p",{className:"text-muted-foreground",children:["Press ",a.jsx("kbd",{className:"bg-muted rounded px-1 py-0.5 text-xs",children:"Ctrl+O"})," to create new graded bags."]})]}),j.includes("graded-bags-pools-create")&&a.jsxs(p,{onClick:()=>l(!0),className:"gap-2",children:[a.jsx(L,{className:"h-4 w-4"}),"Create Graded Bags"]})]}),a.jsxs(T,{defaultValue:"barcodes",className:"w-full",children:[a.jsxs(I,{children:[a.jsx(x,{value:"barcodes",children:"Individual Barcodes"}),a.jsx(x,{value:"grouped",children:"Grouped Summary"})]}),a.jsx(b,{value:"barcodes",children:a.jsx(u,{filterableColumns:k,route:"/api/graded-bags-pools-with-barcodes",columns:S,pageSize:20})}),a.jsx(b,{value:"grouped",children:a.jsx(u,{filterableColumns:v,route:"/api/graded-bags-pools",columns:C,pageSize:20,onEdit:_})})]}),a.jsx(E,{isOpen:y,onClose:()=>l(!1),onSuccess:()=>{var e;l(!1),(e=window.refreshDataTable)==null||e.call(window)}}),s&&a.jsx(O,{isOpen:N,onClose:()=>{o(!1),c(null)},item_id:s.item_id,grade_id:s.grade_id,weight_id:s.weight_id,created_date:s.created_date,itemName:s.itemName,gradeName:s.gradeName,weightValue:s.weightValue,totalQuantity:s.totalQuantity})]})]})}export{he as default};
