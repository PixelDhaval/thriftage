import{K as q,r as n,j as t,L as A}from"./app-C6wr7xOM.js";import{B as h,t as v}from"./index-ByhlrBJ7.js";import{D as k}from"./data-table-BHfKkASQ.js";import{I as D}from"./input-3tYqWR7g.js";import{L as C}from"./label-C16cjRI5.js";import{T as Q,a as R,b as S,c as G}from"./tabs-RWU5GxHX.js";import{A as V}from"./app-layout-B-UflEba.js";import{C as $}from"./CreateGradedBagPoolForm-CFyF-jT6.js";import z from"./GradedBagsGroupDetailDialog-BltJhNd9.js";import{p as B}from"./printGradedBarcodes-BSSWFjmM.js";import{P as K}from"./plus-CcMIaYdc.js";import{P as H}from"./printer-D9gZcDgz.js";import{f as o}from"./format-CiT9Q78D.js";import"./select-Kz6bl7S3.js";import"./index-CrXPg-Qx.js";import"./check-Dpvvyly-.js";import"./chevrons-up-down--zfVwbuH.js";import"./chevron-left-BDlwHnm4.js";import"./chevron-right-Co1gBxOU.js";import"./dialog-Dune_8vQ.js";import"./index-CdYzvuDs.js";import"./progress-e_ADa-gu.js";import"./app-logo-icon-C2DRnRHY.js";import"./index-DpqhE_DT.js";import"./async-select-DfMe9Orv.js";const J=[{title:"Graded Bags Pool",href:"/graded-bags-pools"}];function we(){const g=q().props.auth,P=(g==null?void 0:g.permissions)||[],[T,c]=n.useState(!1),[I,p]=n.useState(!1),[l,u]=n.useState(null),m=o(new Date,"yyyy-MM-dd"),[s,x]=n.useState({from_created_date:m,to_created_date:m}),f=(e,a)=>{x(i=>({...i,[e]:a}))},M=()=>{x({from_created_date:m,to_created_date:m})};n.useEffect(()=>{const e=a=>{a.ctrlKey&&a.key==="o"&&(a.preventDefault(),c(!0))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]);const F=async e=>{var a,i,r,b,y,j,_,w,N;try{let d="kg";(a=e.weight)!=null&&a.weight_type?d=e.weight.weight_type:(r=(i=e.item)==null?void 0:i.section)!=null&&r.weight_type&&(d=e.item.section.weight_type),await B({bags:[e],partyName:"Graded Items",weightValue:((b=e.weight)==null?void 0:b.weight)||"Unknown",itemName:((y=e.item)==null?void 0:y.name)||"Unknown",itemSection:(_=(j=e.item)==null?void 0:j.section)==null?void 0:_.name,gradeName:((w=e.grade)==null?void 0:w.name)||"Unknown",isSingle:!0,weightType:d,pairCount:d==="pair"?parseInt(((N=e.weight)==null?void 0:N.weight)||"0"):void 0}),v.success(`Print initiated for graded barcode ${e.barcode}.`)}catch(d){console.error("Error printing graded barcode:",d),v.error("Failed to print graded barcode.")}},L=e=>{var a,i,r;u({item_id:e.item_id,grade_id:e.grade_id,weight_id:e.weight_id,created_date:e.created_date,itemName:((a=e.item)==null?void 0:a.name)||"Unknown",gradeName:((i=e.grade)==null?void 0:i.name)||"Unknown",weightValue:((r=e.weight)==null?void 0:r.weight)||"Unknown",totalQuantity:e.total_quantity}),p(!0)},E=[{label:"Barcode",key:"barcode"},{label:"Item",key:"item.name"},{label:"Grade",key:"grade.name"},{label:"Weight",key:"weight.weight"},{label:"Created At",key:"created_at"}],O=[{id:"barcode",header:"Barcode",enableSorting:!0,cell:({row:e})=>t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{className:"font-mono text-sm font-medium",children:e.original.barcode})})},{id:"item",header:"Item",enableSorting:!0,cell:({row:e})=>{var a,i,r;return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{children:((a=e.original.item)==null?void 0:a.name)||"-"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",((r=(i=e.original.item)==null?void 0:i.section)==null?void 0:r.name)||"No Section",")"]})]})}},{id:"grade",header:"Grade",enableSorting:!0,cell:({row:e})=>{var a;return t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{children:((a=e.original.grade)==null?void 0:a.name)||"-"})})}},{id:"weight",header:"Weight",enableSorting:!0,cell:({row:e})=>{var a;return t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("span",{children:[((a=e.original.weight)==null?void 0:a.weight)||"-"," kg"]})})}},{id:"created_at",header:"Created At",enableSorting:!0,cell:({row:e})=>t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{children:o(new Date(e.original.created_at),"dd/MM/yyyy HH:mm")})})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:e})=>t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs(h,{variant:"outline",size:"sm",onClick:a=>{a.stopPropagation(),F(e.original)},className:"h-8 px-2",title:"Print this graded barcode label",children:[t.jsx(H,{className:"mr-1 h-3 w-3"}),"Print"]})})}],U=[{label:"Item",key:"item.name"},{label:"Grade",key:"grade.name"},{label:"Weight",key:"weight.weight"},{label:"Created Date",key:"created_date"},{label:"Total Quantity",key:"total_quantity"}],W=[{id:"item",header:"Item",enableSorting:!0,cell:({row:e})=>{var a,i,r;return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{children:((a=e.original.item)==null?void 0:a.name)||"-"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",((r=(i=e.original.item)==null?void 0:i.section)==null?void 0:r.name)||"No Section",")"]})]})}},{id:"grade",header:"Grade",enableSorting:!0,cell:({row:e})=>{var a;return t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{children:((a=e.original.grade)==null?void 0:a.name)||"-"})})}},{id:"weight",header:"Weight",enableSorting:!0,cell:({row:e})=>{var a;return t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("span",{children:[((a=e.original.weight)==null?void 0:a.weight)||"-"," kg"]})})}},{id:"total_quantity",header:"Total Quantity",enableSorting:!0,cell:({row:e})=>t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{className:"font-semibold",children:e.original.total_quantity})})},{id:"total_weight",header:"Total Weight",enableSorting:!1,cell:({row:e})=>{var a;return t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("span",{className:"font-semibold",children:[(e.original.total_quantity*parseFloat(((a=e.original.weight)==null?void 0:a.weight)||"0")).toFixed(2)," kg"]})})}},{id:"created_date",header:"Created Date",enableSorting:!0,cell:({row:e})=>t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{children:o(new Date(e.original.created_date),"dd/MM/yyyy")})})}];return t.jsxs(V,{breadcrumbs:J,children:[t.jsx(A,{title:"Graded Bags Pool"}),t.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[t.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-semibold",children:"Graded Bags Pool"}),t.jsxs("p",{className:"text-muted-foreground",children:["Press ",t.jsx("kbd",{className:"bg-muted rounded px-1 py-0.5 text-xs",children:"Ctrl+O"})," to create new graded bags."]})]}),P.includes("graded-bags-pools-create")&&t.jsxs(h,{onClick:()=>c(!0),className:"gap-2",children:[t.jsx(K,{className:"h-4 w-4"}),"Create Graded Bags"]})]}),t.jsxs(Q,{defaultValue:"barcodes",className:"w-full",children:[t.jsxs(R,{children:[t.jsx(S,{value:"barcodes",children:"Individual Barcodes"}),t.jsx(S,{value:"grouped",children:"Grouped Summary"})]}),t.jsxs("div",{className:"bg-muted/50 mb-6 grid grid-cols-1 gap-4 rounded-lg p-4 md:grid-cols-4",children:[t.jsxs("div",{className:"grid gap-2",children:[t.jsx(C,{htmlFor:"from-date",children:"From Date"}),t.jsx(D,{id:"from-date",type:"date",value:s.from_created_date,onChange:e=>f("from_created_date",e.target.value),className:"w-full"})]}),t.jsxs("div",{className:"grid gap-2",children:[t.jsx(C,{htmlFor:"to-date",children:"To Date"}),t.jsx(D,{id:"to-date",type:"date",value:s.to_created_date,onChange:e=>f("to_created_date",e.target.value),className:"w-full"})]}),t.jsx("div",{className:"flex items-end gap-2",children:t.jsx(h,{variant:"outline",onClick:M,className:"h-10",title:"Reset to today's date",children:"Reset to Today"})}),t.jsx("div",{className:"flex items-end justify-end",children:t.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing data from ",o(new Date(s.from_created_date),"dd/MM/yyyy")," to ",o(new Date(s.to_created_date),"dd/MM/yyyy")]})})]}),t.jsx(G,{value:"barcodes",children:t.jsx(k,{filterableColumns:E,route:"/api/graded-bags-pools-with-barcodes",columns:O,pageSize:20,params:s},`barcodes-${s.from_created_date}-${s.to_created_date}`)}),t.jsx(G,{value:"grouped",children:t.jsx(k,{filterableColumns:U,route:"/api/graded-bags-pools",columns:W,pageSize:20,onEdit:L,params:s},`grouped-${s.from_created_date}-${s.to_created_date}`)})]}),t.jsx($,{isOpen:T,onClose:()=>c(!1),onSuccess:()=>{var e;c(!1),(e=window.refreshDataTable)==null||e.call(window)}}),l&&t.jsx(z,{isOpen:I,onClose:()=>{p(!1),u(null)},item_id:l.item_id,grade_id:l.grade_id,weight_id:l.weight_id,created_date:l.created_date,itemName:l.itemName,gradeName:l.gradeName,weightValue:l.weightValue,totalQuantity:l.totalQuantity})]})]})}export{we as default};
