import{r as s,K as k,j as e,a as h}from"./app-DxEDvTBz.js";import{B as f,t as i}from"./index-DWnafFNg.js";import{D as P}from"./data-table-DE10qEoE.js";import{D as I,a as E,b as _,c as $,d as A}from"./dialog-C5Fs-K6Q.js";import{D as F}from"./delete-confirmation-dialog-CpN80_sA.js";import{p as T}from"./printBarcodes-DK2LknVO.js";import{P as O}from"./printer-Cylv9EoH.js";import"./input-CtyuglOk.js";import"./select-BGYjA_Gx.js";import"./floating-ui.react-dom-D8pU52fc.js";import"./floating-ui.dom-C5vApqfE.js";import"./index-D7zJgkEx.js";import"./check-CBxak93v.js";import"./chevrons-up-down-DXInrhG2.js";import"./index-Cv0lmLWN.js";function Z({isOpen:n,onClose:p,importId:l,partyId:x,weightId:b,partyName:c,weightValue:g}){var u;const[D,d]=s.useState(!1),[r,m]=s.useState(null),[o,j]=s.useState(null),y=((u=k().props.auth)==null?void 0:u.permissions)||[],w=t=>{m(t),d(!0)},B=async()=>{var t,a;if(r)try{await h.delete(`/import-bags/${r.id}`,{headers:{"X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||"",Accept:"application/json"}}),i.success(`Import bag ${r.barcode} deleted successfully.`),(a=window.refreshDataTable)==null||a.call(window)}catch(N){console.error("Error deleting import bag:",N),i.error("Failed to delete import bag. Please try again later.")}d(!1),m(null)};s.useEffect(()=>{n&&(async()=>{try{const a=await h.get(`/api/imports/${l}`);j(a.data)}catch(a){console.error("Error fetching import data:",a)}})()},[l,n]);const C=async t=>{try{await T({bags:[t],partyName:c||"Unknown",containerNo:o==null?void 0:o.container_no,movementDate:o==null?void 0:o.movement_date,weightValue:g||"Unknown",isSingle:!0}),i.success(`Print initiated for barcode ${t.barcode}.`)}catch(a){console.error("Error printing barcode:",a),i.error("Failed to print barcode.")}},S=[{label:"Barcode",key:"barcode"},{label:"Status",key:"status"},{label:"Created At",key:"created_at"}],v=[{id:"barcode",header:"Barcode",enableSorting:!0,cell:({row:t})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-mono text-sm",children:t.original.barcode})})},{id:"status",header:"Status",enableSorting:!0,cell:({row:t})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.original.status==="opened"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.original.status})})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:t})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(f,{variant:"outline",size:"sm",onClick:a=>{a.stopPropagation(),C(t.original)},className:"h-8 px-2",title:"Print this barcode label",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),"Print"]})})}];return e.jsxs(e.Fragment,{children:[e.jsx(I,{open:n,onOpenChange:p,children:e.jsxs(E,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(_,{children:[e.jsxs($,{children:["Import Bags - ",c]}),e.jsxs(A,{children:["Individual bags for ",c," - Weight: ",g," kg"]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(P,{filterableColumns:S,route:"/api/import-bags-with-barcodes",columns:v,pageSize:20,params:{import_id:l,party_id:x,weight_id:b},...y.includes("import-bags-delete")&&{onDelete:w}})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(f,{variant:"outline",onClick:p,children:"Close"})})]})}),e.jsx(F,{isOpen:D,onClose:()=>{d(!1),m(null)},onConfirm:B,title:"Delete Import Bag",description:`Are you sure you want to delete import bag with barcode ${r==null?void 0:r.barcode}? This action cannot be undone.`})]})}export{Z as default};
