import{r as n,j as e,a as v}from"./app-B81GrNVN.js";import{D as L}from"./data-table-g425Msrv.js";import{C as c,a as A,b as B,c as m}from"./card-0QFjGi19.js";import{B as w,t as x}from"./index-BmlTZoYn.js";import{L as g}from"./label-abHCevWa.js";import{I as _}from"./input-CgHuFDRy.js";import{S as $,a as W,b as O,c as V,d as z}from"./select-BUwKcd6J.js";import{A as H}from"./async-select-DsxhFxiQ.js";import{F as U}from"./file-spreadsheet-BhIVyyHD.js";import{f as o}from"./format-CiT9Q78D.js";import"./chevrons-up-down-CG-NcDHP.js";import"./chevron-left-BmLwpZCy.js";import"./chevron-right-YmbVTZn4.js";import"./index-D9XNSD-3.js";import"./check-Cyb-QuqB.js";function oe(){var N;const[Y,C]=n.useState([]),[h,D]=n.useState([]),[i,p]=n.useState(null),[r,u]=n.useState(null),[l,f]=n.useState({from_date:o(new Date,"yyyy-MM-dd"),to_date:o(new Date,"yyyy-MM-dd")}),[d,F]=n.useState(null),[j,y]=n.useState(!1);n.useEffect(()=>{(async()=>{try{const[a,s]=await Promise.all([v.get("/api/sections"),v.get("/api/grades")]);C(a.data),D(s.data)}catch(a){console.error("Error fetching data:",a),x.error("Failed to load data for report filters.")}})()},[]);const S=(t,a)=>{f(s=>({...s,[t]:a}))},E=()=>{f({from_date:o(new Date,"yyyy-MM-dd"),to_date:o(new Date,"yyyy-MM-dd")})},M=t=>{p(t)},R=()=>{E(),p(null),u(null)},T=async()=>{try{y(!0);const t={...l,section_id:i==null?void 0:i.id,grade_id:r==null?void 0:r.id,export:"excel"},a=new URL("/api/reports/production",window.location.origin);Object.entries(t).forEach(([s,b])=>{b&&a.searchParams.append(s,String(b))}),window.open(a.toString(),"_blank"),x.success("Excel export initiated. Your download should begin shortly.")}catch(t){console.error("Error exporting report:",t),x.error("Failed to export Excel report.")}finally{y(!1)}},k=[{label:"Item",key:"item.name"},{label:"Section",key:"item.section.name"},{label:"Grade",key:"grade.name"}],I=[{id:"item.name",header:"Item",enableSorting:!0,cell:({row:t})=>{var a;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((a=t.original.item)==null?void 0:a.name)||"-"})})}},{id:"item.section.name",header:"Section",enableSorting:!0,cell:({row:t})=>{var a,s;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((s=(a=t.original.item)==null?void 0:a.section)==null?void 0:s.name)||"-"})})}},{id:"grade.name",header:"Grade",enableSorting:!0,cell:({row:t})=>{var a;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((a=t.original.grade)==null?void 0:a.name)||"-"})})}},{id:"weight.weight",header:"Weight / Pairs",enableSorting:!0,cell:({row:t})=>{var a,s;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:[((a=t.original.weight)==null?void 0:a.weight)||"-",((s=t.original.weight)==null?void 0:s.weight_type)==="pair"?" pairs":" kg"]})})}},{id:"total_bags",header:"Total Bags",enableSorting:!0,cell:({row:t})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-medium",children:t.original.total_bags})})},{id:"total_weight",header:"Total Weight",enableSorting:!0,cell:({row:t})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"font-medium",children:[parseFloat(t.original.total_weight).toFixed(2)," kg"]})})}],P=t=>{t&&t.summary&&F(t.summary)};return e.jsx("div",{className:"space-y-6",children:e.jsxs(c,{children:[e.jsx(A,{children:e.jsx(B,{children:"Production Report"})}),e.jsxs(m,{children:[e.jsxs("div",{className:"bg-muted/50 mb-6 grid grid-cols-1 gap-4 rounded-lg p-4 md:grid-cols-3 lg:grid-cols-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"from-date",children:"From Date"}),e.jsx(_,{id:"from-date",type:"date",value:l.from_date,onChange:t=>S("from_date",t.target.value),className:"w-full"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"to-date",children:"To Date"}),e.jsx(_,{id:"to-date",type:"date",value:l.to_date,onChange:t=>S("to_date",t.target.value),className:"w-full"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"section",children:"Section"}),e.jsx(H,{route:"/api/sections/select",value:i,onChange:M,placeholder:"All sections",renderOption:t=>t.name,renderSelected:t=>t.name,isClearable:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"grade",children:"Grade"}),e.jsxs($,{value:(N=r==null?void 0:r.id)==null?void 0:N.toString(),onValueChange:t=>{const a=h.find(s=>s.id.toString()===t);u(a||null)},children:[e.jsx(W,{children:e.jsx(O,{placeholder:"All grades"})}),e.jsx(V,{children:h.map(t=>e.jsx(z,{value:t.id.toString(),children:t.name},t.id))})]})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(w,{variant:"outline",onClick:R,className:"h-10",children:"Reset Filters"}),e.jsxs(w,{variant:"outline",onClick:T,className:"h-10 gap-2",disabled:j,children:[e.jsx(U,{className:"h-4 w-4"}),j?"Exporting...":"Export Excel"]})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing data from ",o(new Date(l.from_date),"dd/MM/yyyy")," to ",o(new Date(l.to_date),"dd/MM/yyyy")]})})]}),d&&e.jsxs("div",{className:"mb-6 grid grid-cols-3 gap-4",children:[e.jsx(c,{children:e.jsxs(m,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:d.total_records}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Records"})]})}),e.jsx(c,{children:e.jsxs(m,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:d.total_bags}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Bags"})]})}),e.jsx(c,{children:e.jsxs(m,{className:"pt-6",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[parseFloat(d.total_weight).toFixed(2)," kg"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Weight"})]})})]}),e.jsx(L,{filterableColumns:k,route:"/api/reports/production",columns:I,pageSize:20,params:{...l,section_id:i==null?void 0:i.id,grade_id:r==null?void 0:r.id},onDataLoaded:P},`${l.from_date}-${l.to_date}-${i==null?void 0:i.id}-${r==null?void 0:r.id}`)]})]})})}export{oe as default};
