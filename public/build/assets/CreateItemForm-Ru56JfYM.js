import{r as a,m as A,j as e,a as u}from"./app-C6wr7xOM.js";import{B as R,t as m}from"./index-ByhlrBJ7.js";import{f as V}from"./dialog-Dune_8vQ.js";import{I as k}from"./input-3tYqWR7g.js";import{L as l}from"./label-C16cjRI5.js";import{T as q}from"./textarea-C-bcnIPy.js";import{S as y,a as N,b as v,c as E,d as b}from"./select-Kz6bl7S3.js";import{A as B}from"./async-select-DfMe9Orv.js";import"./index-CdYzvuDs.js";import"./index-CrXPg-Qx.js";import"./check-Dpvvyly-.js";function Z({onSuccess:p}){const[C,x]=a.useState(!1),[f,F]=a.useState([]),[o,j]=a.useState([]),{data:d,setData:n,errors:i,setError:I,reset:W,clearErrors:G}=A({name:"",section_id:"",grade_id:"",default_weight_id:"",description:""}),[r,D]=a.useState(null),[L,O]=a.useState(null),[_,g]=a.useState(null);a.useEffect(()=>{(async()=>{try{const s=await u.get("/api/grades");F(s.data)}catch(s){console.error("Error fetching grades:",s)}})()},[]),a.useEffect(()=>{r?(async()=>{try{const s=await u.get("/api/weights/select",{params:{weight_type:r.weight_type}});j(s.data),_&&_.weight_type!==r.weight_type&&(g(null),n("default_weight_id",""))}catch(s){console.error("Error fetching weights:",s),m.error("Failed to load weights for this section.")}})():(j([]),g(null),n("default_weight_id",""))},[r]);const T=async t=>{var s,c;t.preventDefault(),G(),x(!0);try{const h=await u.post("/items",d,{headers:{"X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||"","Content-Type":"application/json",Accept:"application/json"}});m.success("Item created successfully!"),W(),p==null||p()}catch(h){if(console.error("Error creating item:",h),((c=h.response)==null?void 0:c.status)===422){const S=h.response.data.errors;Object.keys(S).forEach(w=>{I(w,S[w][0])}),m.error("Please check the form for errors.")}else m.error("Failed to create item. Please try again later.")}finally{x(!1)}};return e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"name",children:"Name"}),e.jsx(k,{id:"name",value:d.name,onChange:t=>n("name",t.target.value),required:!0,placeholder:"Enter item name"}),i.name&&e.jsx("p",{className:"text-destructive text-sm",children:i.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"section_id",children:"Section"}),e.jsx(B,{route:"/api/sections/select",value:r,onChange:t=>{n("section_id",t.id.toString()),D(t)},renderOption:t=>`${t.name} (${t.weight_type.toUpperCase()})`,renderSelected:t=>t.name}),i.section_id&&e.jsx("p",{className:"text-destructive text-sm",children:i.section_id}),r&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Weight type: ",e.jsx("span",{className:"font-medium",children:r.weight_type.toUpperCase()})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"grade_id",children:"Grade"}),e.jsxs(y,{value:d.grade_id,onValueChange:t=>{n("grade_id",t);const s=f.find(c=>c.id.toString()===t);O(s||null)},children:[e.jsx(N,{children:e.jsx(v,{placeholder:"Select grade"})}),e.jsx(E,{children:f.map(t=>e.jsx(b,{value:t.id.toString(),children:t.name},t.id))})]}),i.grade_id&&e.jsx("p",{className:"text-destructive text-sm",children:i.grade_id})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"default_weight_id",children:"Default Weight (Optional)"}),e.jsxs(y,{value:d.default_weight_id,onValueChange:t=>{n("default_weight_id",t);const s=o.find(c=>c.id.toString()===t);g(s||null)},disabled:!r||o.length===0,children:[e.jsx(N,{children:e.jsx(v,{placeholder:r?"Select default weight":"Select a section first"})}),e.jsx(E,{children:o.map(t=>e.jsxs(b,{value:t.id.toString(),children:[t.weight," ",t.weight_type]},t.id))})]}),i.default_weight_id&&e.jsx("p",{className:"text-destructive text-sm",children:i.default_weight_id}),r?o.length===0?e.jsxs("p",{className:"text-sm text-amber-500",children:["No weights found for ",r.weight_type," weight type"]}):e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Optional default weight for this item (",r.weight_type," weight type)"]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a section first to see compatible weights"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"description",children:"Description"}),e.jsx(q,{id:"description",value:d.description||"",onChange:t=>n("description",t.target.value),placeholder:"Enter description (optional)",rows:3}),i.description&&e.jsx("p",{className:"text-destructive text-sm",children:i.description})]})]}),e.jsx(V,{children:e.jsx(R,{type:"submit",disabled:C,children:"Create Item"})})]})}export{Z as default};
