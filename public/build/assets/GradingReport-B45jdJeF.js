import{r as o,j as e,a as _}from"./app-B81GrNVN.js";import{D as P}from"./data-table-g425Msrv.js";import{C as c,a as A,b as $,c as m}from"./card-0QFjGi19.js";import{B as v,t as x}from"./index-BmlTZoYn.js";import{L as p}from"./label-abHCevWa.js";import{I as b}from"./input-CgHuFDRy.js";import{S as W,a as B,b as O,c as U,d as V}from"./select-BUwKcd6J.js";import{A as z}from"./async-select-DsxhFxiQ.js";import{F as H}from"./file-spreadsheet-BhIVyyHD.js";import{f as n}from"./format-CiT9Q78D.js";import"./chevrons-up-down-CG-NcDHP.js";import"./chevron-left-BmLwpZCy.js";import"./chevron-right-YmbVTZn4.js";import"./index-D9XNSD-3.js";import"./check-Cyb-QuqB.js";function ne(){var S;const[Y,w]=o.useState([]),[g,C]=o.useState([]),[r,h]=o.useState(null),[s,u]=o.useState(null),[l,f]=o.useState({from_date:n(new Date,"yyyy-MM-dd"),to_date:n(new Date,"yyyy-MM-dd")}),[d,D]=o.useState(null),[F,j]=o.useState(!1);o.useEffect(()=>{(async()=>{try{const[a,i]=await Promise.all([_.get("/api/sections"),_.get("/api/grades")]);w(a.data),C(i.data)}catch(a){console.error("Error fetching data:",a),x.error("Failed to load data for report filters.")}})()},[]);const y=(t,a)=>{f(i=>({...i,[t]:a}))},E=()=>{f({from_date:n(new Date,"yyyy-MM-dd"),to_date:n(new Date,"yyyy-MM-dd")})},M=t=>{h(t)},T=()=>{E(),h(null),u(null)},R=async()=>{try{j(!0);const t={...l,section_id:r==null?void 0:r.id,grade_id:s==null?void 0:s.id,export:"excel"},a=new URL("/api/reports/grading",window.location.origin);Object.entries(t).forEach(([i,N])=>{N&&a.searchParams.append(i,String(N))}),window.open(a.toString(),"_blank"),x.success("Excel export initiated. Your download should begin shortly.")}catch(t){console.error("Error exporting report:",t),x.error("Failed to export Excel report.")}finally{j(!1)}},k=[{label:"Section",key:"section.name"},{label:"Grade",key:"grade.name"}],I=[{id:"section",header:"Section",enableSorting:!0,cell:({row:t})=>{var a;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((a=t.original.section)==null?void 0:a.name)||"-"})})}},{id:"grade",header:"Grade",enableSorting:!0,cell:({row:t})=>{var a;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((a=t.original.grade)==null?void 0:a.name)||"-"})})}},{id:"total_weight",header:"Total Weight",enableSorting:!0,cell:({row:t})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"font-medium",children:[parseFloat(t.original.total_weight).toFixed(2)," kg"]})})},{id:"total_pairs",header:"Total Pairs",enableSorting:!0,cell:({row:t})=>t.original.total_pairs>0?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-medium",children:parseInt(t.original.total_pairs).toLocaleString()})}):e.jsx("span",{className:"text-muted-foreground",children:"-"})},{id:"weight_type",header:"Weight Type",enableSorting:!1,cell:({row:t})=>{const a=t.original.section,i=(a==null?void 0:a.weight_type)||"kg";return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:i.toUpperCase()})})}}],L=t=>{t&&t.summary&&D(t.summary)};return e.jsx("div",{className:"space-y-6",children:e.jsxs(c,{children:[e.jsx(A,{children:e.jsx($,{children:"Grading Report (Section-wise)"})}),e.jsxs(m,{children:[e.jsxs("div",{className:"bg-muted/50 mb-6 grid grid-cols-1 gap-4 rounded-lg p-4 md:grid-cols-3 lg:grid-cols-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"from-date",children:"From Date"}),e.jsx(b,{id:"from-date",type:"date",value:l.from_date,onChange:t=>y("from_date",t.target.value),className:"w-full"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"to-date",children:"To Date"}),e.jsx(b,{id:"to-date",type:"date",value:l.to_date,onChange:t=>y("to_date",t.target.value),className:"w-full"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"section",children:"Section"}),e.jsx(z,{route:"/api/sections/select",value:r,onChange:M,placeholder:"All sections",renderOption:t=>t.name,renderSelected:t=>t.name,isClearable:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"grade",children:"Grade"}),e.jsxs(W,{value:(S=s==null?void 0:s.id)==null?void 0:S.toString(),onValueChange:t=>{const a=g.find(i=>i.id.toString()===t);u(a||null)},children:[e.jsx(B,{children:e.jsx(O,{placeholder:"All grades"})}),e.jsx(U,{children:g.map(t=>e.jsx(V,{value:t.id.toString(),children:t.name},t.id))})]})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:T,className:"h-10",children:"Reset Filters"}),e.jsxs(v,{variant:"outline",onClick:R,className:"h-10 gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),F?"Exporting...":"Export Excel"]})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing data from ",n(new Date(l.from_date),"dd/MM/yyyy")," to ",n(new Date(l.to_date),"dd/MM/yyyy")]})})]}),d&&e.jsxs("div",{className:"mb-6 grid grid-cols-3 gap-4",children:[e.jsx(c,{children:e.jsxs(m,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:d.total_records}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Records"})]})}),e.jsx(c,{children:e.jsxs(m,{className:"pt-6",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[parseFloat(d.total_weight).toFixed(2)," kg"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Weight"})]})}),e.jsx(c,{children:e.jsxs(m,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:d.total_pairs>0?parseInt(d.total_pairs).toLocaleString():"N/A"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Pairs"})]})})]}),e.jsx(P,{filterableColumns:k,route:"/api/reports/grading",columns:I,pageSize:20,params:{...l,section_id:r==null?void 0:r.id,grade_id:s==null?void 0:s.id},onDataLoaded:L},`${l.from_date}-${l.to_date}-${r==null?void 0:r.id}-${s==null?void 0:s.id}`)]})]})})}export{ne as default};
