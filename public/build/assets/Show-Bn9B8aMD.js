import{r as i,j as e,L as xe,a as I}from"./app-B81GrNVN.js";import{A as pe}from"./async-select-DsxhFxiQ.js";import{a as je,B as n,t as m}from"./index-BmlTZoYn.js";import{C as l,a as j,b as u,c as d}from"./card-0QFjGi19.js";import{D as A}from"./data-table-g425Msrv.js";import{D as b,e as f,a as y,b as N,c as w,d as v}from"./dialog-_1aMC81m.js";import{L as V}from"./label-abHCevWa.js";import{S as ue,a as be,b as fe,c as ye,d as $}from"./select-BUwKcd6J.js";import{T as Ne,a as we,b as C,c as P}from"./tabs-D61MmZJE.js";import{A as ve,P as _e}from"./app-layout-DxSffBsZ.js";import{p as z}from"./printBarcodes-CjbQAGag.js";import H from"./AddImportBagForm-Duwdzjfw.js";import Se from"./EditImportForm-CiaGttIb.js";import Be from"./ImportBagsWithBarcodesDialog-C_omLvqH.js";import Ie from"./CreateGradedItemPoolForm-B0Pk2hPW.js";import{P as R}from"./printer-CUg1IuD4.js";import{P as k}from"./plus-CC6at3HC.js";import{f as h}from"./format-CiT9Q78D.js";import"./input-CgHuFDRy.js";import"./chevrons-up-down-CG-NcDHP.js";import"./chevron-left-BmLwpZCy.js";import"./chevron-right-YmbVTZn4.js";import"./index-CWdVyxEp.js";import"./index-D9XNSD-3.js";import"./check-Cyb-QuqB.js";import"./progress-Cv1I-sH5.js";import"./app-logo-icon-DYYlSjg_.js";import"./index-Carsqqyp.js";import"./CreateGradedBagPoolForm-Ctbh8bFL.js";import"./printGradedBarcodes-C9_5HlU_.js";import"./delete-confirmation-dialog-B47qwWZc.js";import"./subDays-jiZAUARE.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Ce=je("SquarePen",Ae);function hs({import:a}){var E,W,U,L;const[q,O]=i.useState(!1),[Q,G]=i.useState(!1),[J,F]=i.useState(!1),[K,_]=i.useState(!1),[o,S]=i.useState(null),[X,T]=i.useState(!1),[Pe,ke]=i.useState(!1),[Oe,Ge]=i.useState(null),Y=[{title:"Imports Management",href:"/imports"},{title:(a.type=="container"?a.container_no:(E=a.party)==null?void 0:E.name)||"N/A",href:"#"}],[x,B]=i.useState({import_id:a.id,party_id:"",weight_id:""}),[Z,M]=i.useState(null),[D,ee]=i.useState([]),[c,se]=i.useState(null);i.useEffect(()=>{(async()=>{try{const[t,r]=await Promise.all([I.get("/api/weights"),I.get(`/api/imports/${a.id}/stats`)]);ee(t.data),se(r.data)}catch(t){console.error("Error fetching data:",t)}})()},[a.id]);const ae=s=>{M(s),B(t=>({...t,party_id:(s==null?void 0:s.id)||""}))},te=s=>{B(t=>({...t,weight_id:s}))},re=()=>{M(null),B({import_id:a.id,party_id:"",weight_id:""})},ie=s=>{var t,r;S({importId:a.id,partyId:s.original.party_id,weightId:s.original.weight_id,partyName:((t=s.original.party)==null?void 0:t.name)||"Unknown",weightValue:((r=s.original.weight)==null?void 0:r.weight)||"Unknown"}),_(!0)},ne=async s=>{var t,r;try{const g=await I.get("/api/import-bags-with-barcodes",{params:{import_id:a.id,party_id:s.original.party_id,weight_id:s.original.weight_id}}),p=g.data.data||g.data;if(p.length===0){m.error("No bags found to print.");return}await z({bags:p,partyName:((t=s.original.party)==null?void 0:t.name)||"Unknown",containerNo:a.container_no,movementDate:a.movement_date,weightValue:((r=s.original.weight)==null?void 0:r.weight)||"Unknown",totalQuantity:p.length}),m.success(`Print initiated for ${p.length} barcodes.`)}catch(g){console.error("Error fetching bags for printing:",g),m.error("Failed to fetch bags for printing.")}},le=async s=>{var t,r;try{await z({bags:[s],partyName:((t=s.party)==null?void 0:t.name)||"Unknown",containerNo:a.container_no,movementDate:a.movement_date,weightValue:((r=s.weight)==null?void 0:r.weight)||"Unknown",isSingle:!0,totalQuantity:1}),m.success(`Print initiated for barcode ${s.barcode}.`)}catch(g){console.error("Error printing barcode:",g),m.error("Failed to print barcode.")}},de=[{label:"Party",key:"party.name"},{label:"Weight",key:"weight"},{label:"Status",key:"status"}],ce=[...a.type==="container"?[{id:"party",header:"Party",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((t=s.original.party)==null?void 0:t.name)||"-"})})}}]:[],{id:"weight",header:"Weight",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:[((t=s.original.weight)==null?void 0:t.weight)||"-"," kg"]})})}},{id:"bag_count",header:"Bag Count",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(n,{variant:"link",className:"h-auto p-0 font-semibold text-blue-600",onClick:()=>ie(s),children:s.original.bag_count||0})})},{id:"opened_count",header:"Opened",enableSorting:!1,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-green-600",children:s.original.opened_count||0})})},{id:"unopened_count",header:"Unopened",enableSorting:!1,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-red-600",children:s.original.unopened_count||0})})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(n,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),ne(s)},className:"h-8 px-2",title:"Print all barcodes for this party and weight",children:[e.jsx(R,{className:"mr-1 h-3 w-3"}),"Print All"]})})}],oe=[{label:"Barcode",key:"barcode"},{label:"Party",key:"party.name"},{label:"Weight",key:"weight"},{label:"Status",key:"status"},{label:"Created At",key:"created_at"}],ge=[{id:"barcode",header:"Barcode",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-mono text-sm",children:s.original.barcode})})},...a.type==="container"?[{id:"party",header:"Party",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((t=s.original.party)==null?void 0:t.name)||"-"})})}}]:[],{id:"weight",header:"Weight",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:[((t=s.original.weight)==null?void 0:t.weight)||"-"," kg"]})})}},{id:"status",header:"Status",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`rounded-full px-2 py-1 text-xs ${s.original.status==="opened"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.original.status})})},{id:"created_at",header:"Created At",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:h(s.original.created_at,"dd/MM/yyyy")})})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(n,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),le(s.original)},className:"h-8 px-2",title:"Print this barcode label",children:[e.jsx(R,{className:"mr-1 h-3 w-3"}),"Print"]})})}],he=[{label:"Party",key:"party.name"},{label:"Section",key:"section.name"},{label:"Grade",key:"grade.name"},{label:"Weight",key:"weight"},{label:"Graded At",key:"graded_at"}],me=[...a.type==="container"?[{id:"party",header:"Party",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((t=s.original.party)==null?void 0:t.name)||"-"})})}}]:[],{id:"section",header:"Section",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((t=s.original.section)==null?void 0:t.name)||"-"})})}},{id:"grade",header:"Grade",enableSorting:!0,cell:({row:s})=>{var t;return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:((t=s.original.grade)==null?void 0:t.name)||"-"})})}},{id:"weight",header:"Weight",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"font-semibold",children:[s.original.weight," kg"]})})},{id:"graded_at",header:"Graded At",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:h(new Date(s.original.graded_at),"dd/MM/yyyy")})})},{id:"created_at",header:"Created At",enableSorting:!0,cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:h(new Date(s.original.created_at),"dd/MM/yyyy HH:mm")})})}];return e.jsxs(ve,{breadcrumbs:Y,children:[e.jsx(xe,{title:`Import Details - ${a.type=="container"?a.container_no:((W=a.party)==null?void 0:W.name)||"N/A"}`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs(l,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(u,{children:"Import Details"}),e.jsxs(b,{open:q,onOpenChange:O,children:[e.jsx(f,{asChild:!0,children:e.jsxs(n,{variant:"outline",size:"sm",children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Edit Import"]})}),e.jsxs(y,{children:[e.jsxs(N,{children:[e.jsx(w,{children:"Edit Import"}),e.jsx(v,{children:"Update import details."})]}),e.jsx(Se,{import:a,onSuccess:()=>{O(!1),window.location.reload()}})]})]})]}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"Party Information"}),e.jsx("p",{className:"text-lg font-medium",children:((U=a.party)==null?void 0:U.name)||"N/A"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:((L=a.party)==null?void 0:L.type)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:a.type==="container"?"Container Details":"Reference Details"}),e.jsx("p",{className:"text-lg font-medium",children:a.container_no||"N/A"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:a.movement_date?h(a.movement_date,"dd/MM/yyyy"):"N/A"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"Import Type"}),e.jsx("span",{className:`rounded-full px-2 py-1 text-xs ${a.type==="container"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:a.type==="container"?"Via Container":"Local Delivery"})]}),a.type==="container"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"BL Details"}),e.jsxs("p",{className:"text-sm",children:["No: ",a.bl_no||"N/A"]}),e.jsxs("p",{className:"text-sm",children:["Date: ",a.bl_date?h(a.bl_date,"dd/MM/yyyy"):"N/A"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"BE Details"}),e.jsxs("p",{className:"text-sm",children:["No: ",a.be_no||"N/A"]}),e.jsxs("p",{className:"text-sm",children:["Date: ",a.be_date?h(a.be_date,"dd/MM/yyyy"):"N/A"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground mb-2 text-sm font-semibold",children:"Weights"}),a.type==="container"&&e.jsxs("p",{className:"text-sm",children:["BL: ",a.bl_weight?`${a.bl_weight} kg`:"N/A"]}),e.jsxs("p",{className:"text-sm",children:[a.type==="container"?"WB:":"Total:"," ",a.weigh_bridge_weight?`${a.weigh_bridge_weight} kg`:"N/A"]})]})]})})]}),c&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsx(l,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Bags"}),e.jsx("p",{className:"text-2xl font-bold",children:c.total_bags})]})]})})}),e.jsx(l,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-5 rounded bg-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Opened Bags"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.opened_bags})]})]})})}),e.jsx(l,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-5 rounded bg-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unopened Bags"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.unopened_bags})]})]})})}),e.jsx(l,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-5 rounded bg-amber-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Opening Progress"}),e.jsxs("p",{className:"text-2xl font-bold text-amber-600",children:[c.total_bags>0?Math.round(c.opened_bags/c.total_bags*100):0,"%"]})]})]})})})]}),e.jsxs(Ne,{defaultValue:"bags",className:"w-full",children:[e.jsxs(we,{children:[e.jsx(C,{value:"bags",children:"Import Bags"}),e.jsx(C,{value:"barcode-bags",children:"Barcode wise Bags"}),e.jsx(C,{value:"grading",children:"Graded Items Pool"})]}),e.jsx(P,{value:"bags",children:e.jsxs(l,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(u,{children:"Import Bags"}),e.jsxs(b,{open:Q,onOpenChange:G,children:[e.jsx(f,{asChild:!0,children:e.jsxs(n,{children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Add Bags"]})}),e.jsxs(y,{children:[e.jsxs(N,{children:[e.jsx(w,{children:"Add Import Bags"}),e.jsx(v,{children:"Add new bags to this import."})]}),e.jsx(H,{importData:a,onSuccess:()=>{var s;G(!1),(s=window.refreshDataTable)==null||s.call(window)}})]})]})]}),e.jsx(d,{children:e.jsx(A,{filterableColumns:de,route:"/api/import-bags",columns:ce,pageSize:20,params:{import_id:a.id},onEdit:s=>{var t,r;console.log(s),S({importId:a.id,partyId:s.party_id,weightId:s.weight_id,partyName:((t=s.party)==null?void 0:t.name)||"Unknown",weightValue:((r=s.weight)==null?void 0:r.weight)||"Unknown"}),_(!0)}})})]})}),e.jsx(P,{value:"barcode-bags",children:e.jsxs(l,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(u,{children:"Barcode wise Bags"}),e.jsxs(b,{open:J,onOpenChange:F,children:[e.jsx(f,{asChild:!0,children:e.jsxs(n,{children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Add Import Bags"]})}),e.jsxs(y,{children:[e.jsxs(N,{children:[e.jsx(w,{children:"Add Import Bags"}),e.jsx(v,{children:"Add new bags to this import."})]}),e.jsx(H,{importData:a,onSuccess:()=>{var s;F(!1),(s=window.refreshDataTable)==null||s.call(window)}})]})]})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"bg-muted/50 mb-6 grid grid-cols-1 gap-4 rounded-lg p-4 md:grid-cols-3",children:[a.type==="container"&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(V,{htmlFor:"party-filter",children:"Filter by Party"}),e.jsx(pe,{route:"/api/parties/select",params:{type:"supplier"},value:Z,onChange:ae,placeholder:"All parties",renderOption:s=>s.name,renderSelected:s=>s.name,isClearable:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(V,{htmlFor:"weight-filter",children:"Filter by Weight"}),e.jsxs(ue,{value:x.weight_id,onValueChange:te,children:[e.jsx(be,{children:e.jsx(fe,{placeholder:"All weights"})}),e.jsxs(ye,{children:[e.jsx($,{children:"All weights"}),D.map(s=>e.jsxs($,{value:s.id.toString(),children:[s.weight," kg"]},s.id))]})]})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsx(n,{variant:"outline",onClick:re,className:"h-10",children:"Reset Filters"})})]}),e.jsx(A,{filterableColumns:oe,route:"/api/import-bags-with-barcodes",columns:ge,pageSize:20,params:x},`${x.party_id}-${x.weight_id}`)]})]})}),e.jsx(P,{value:"grading",children:e.jsxs(l,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(u,{children:"Graded Items Pool"}),e.jsxs(b,{open:X,onOpenChange:T,children:[e.jsx(f,{asChild:!0,children:e.jsxs(n,{children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Add Graded Item"]})}),e.jsxs(y,{className:"max-w-md",children:[e.jsxs(N,{children:[e.jsx(w,{children:"Add Graded Item Pool"}),e.jsx(v,{children:"Add graded item to this import."})]}),e.jsx(Ie,{importData:a,onSuccess:()=>{var s;T(!1),(s=window.refreshDataTable)==null||s.call(window)}})]})]})]}),e.jsx(d,{children:e.jsx(A,{filterableColumns:he,route:"/api/graded-items-pools",columns:me,pageSize:20,params:{import_id:a.id}})})]})})]}),o&&e.jsx(Be,{isOpen:K,onClose:()=>{_(!1),S(null)},importId:o.importId,partyId:o.partyId,weightId:o.weightId,partyName:o.partyName,weightValue:o.weightValue})]})]})}export{hs as default};
