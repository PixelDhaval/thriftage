import{r as i,j as a,a as x}from"./app-CMik14HJ.js";import{A as S}from"./async-select-DZWKgv0B.js";import{B as $,t as l}from"./index-CakOBAWj.js";import{I as N}from"./input-ALDPQvLe.js";import{L as m}from"./label-DRAuss-2.js";import{S as q,a as R,b as B,c as L,d as T}from"./select-BvBzlWgt.js";import{f as w}from"./format-CBpsKyOP.js";import"./floating-ui.dom-C5vApqfE.js";import"./floating-ui.react-dom-CUGvTVI4.js";import"./index-BBZuHhmn.js";import"./check-DU87odb6.js";function ae({importData:s,onSuccess:I}){var j;const[f,y]=i.useState(!1),[r,g]=i.useState({import_id:s.id,party_id:s.type==="local"?s.party_id:"",item_id:"",grade_id:"",weight:"",graded_at:w(new Date,"yyyy-MM-dd")}),[C,h]=i.useState(s.type==="local"?{id:s.party_id,name:(j=s.party)==null?void 0:j.name}:null),[G,v]=i.useState(null),[F,P]=i.useState([]),[V,A]=i.useState([]),[o,E]=i.useState(0);i.useEffect(()=>{(async()=>{try{const[t,n]=await Promise.all([x.get("/api/grades"),x.get(`/api/imports/${s.id}/available-opened-goods`)]);if(P(t.data),A(n.data),r.party_id){const p=n.data.filter(c=>c.party_id==r.party_id).reduce((c,d)=>c+d.available_weight,0);E(p)}}catch(t){console.error("Error fetching data:",t),l.error("Failed to load form data.")}})()},[s.id,r.party_id]);const M=e=>{h(e),g(t=>({...t,party_id:(e==null?void 0:e.id)||""}))},k=e=>{v(e),g(t=>({...t,item_id:(e==null?void 0:e.id)||""}))},b=(e,t)=>{g(n=>({...n,[e]:t}))},O=async e=>{var n,u,p,c;if(e.preventDefault(),!r.party_id||!r.item_id||!r.grade_id||!r.weight||!r.graded_at){l.error("Please fill in all required fields");return}const t=parseFloat(r.weight.toString());if(t<=0){l.error("Weight must be greater than 0");return}if(t>o){l.error(`Insufficient opened goods available. Maximum available: ${o}kg`);return}y(!0);try{const d={...r,weight:t,graded_at:w(r.graded_at,"yyyy-MM-dd")};(await x.post("/graded-items-pools",d)).data.success&&(l.success("Graded item pool created successfully!"),I(),g({import_id:s.id,party_id:s.type==="local"?s.party_id:"",item_id:"",grade_id:"",weight:"",graded_at:new Date}),v(null),h(null),s.type==="container"&&h(null))}catch(d){if(console.error("Error creating graded item pool:",d),(u=(n=d.response)==null?void 0:n.data)!=null&&u.message)l.error(d.response.data.message);else if((c=(p=d.response)==null?void 0:p.data)!=null&&c.errors){const _=d.response.data.errors,W=Object.values(_)[0];l.error(W[0])}else l.error("Failed to create graded item pool. Please try again.")}finally{y(!1)}};return a.jsxs("form",{onSubmit:O,className:"space-y-4",children:[s.type==="container"&&a.jsxs("div",{className:"grid gap-2",children:[a.jsx(m,{htmlFor:"party",children:"Party *"}),a.jsx(S,{route:"/api/parties/select",params:{type:"supplier"},value:C,onChange:M,placeholder:"Select party",renderOption:e=>e.name,renderSelected:e=>e.name})]}),o>0&&a.jsx("div",{className:"p-3 border rounded-lg bg-blue-50",children:a.jsxs("div",{className:"text-sm text-blue-900",children:[a.jsx("div",{className:"font-medium mb-1",children:"Available for Grading:"}),a.jsxs("div",{className:"font-bold text-lg",children:[o," kg"]}),a.jsx("div",{className:"text-xs text-blue-700",children:"Total weight of opened goods available for grading"})]})}),o===0&&r.party_id&&a.jsx("div",{className:"p-3 border rounded-lg bg-red-50",children:a.jsxs("div",{className:"text-sm text-red-900",children:[a.jsx("div",{className:"font-medium",children:"No opened goods available for grading"}),a.jsx("div",{className:"text-xs text-red-700",children:"Please open some bags before creating graded items"})]})}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(m,{htmlFor:"item",children:"Item *"}),a.jsx(S,{route:"/api/items/select",value:G,onChange:k,placeholder:"Select item",renderOption:e=>{var t;return`${e.name} - ${((t=e.section)==null?void 0:t.name)||"No Section"}`},renderSelected:e=>e.name})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(m,{htmlFor:"grade",children:"Grade *"}),a.jsxs(q,{value:r.grade_id,onValueChange:e=>b("grade_id",e),required:!0,children:[a.jsx(R,{children:a.jsx(B,{placeholder:"Select grade"})}),a.jsx(L,{children:F.map(e=>a.jsx(T,{value:e.id.toString(),children:e.name},e.id))})]})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(m,{htmlFor:"weight",children:"Weight (kg) *"}),a.jsx(N,{id:"weight",type:"number",step:"0.01",min:"0.01",max:o||void 0,value:r.weight,onChange:e=>b("weight",e.target.value),placeholder:"Enter weight in kg",required:!0}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter the weight of graded items in kilograms"})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(m,{htmlFor:"graded_at",children:"Graded At *"}),a.jsx(N,{id:"graded_at",className:"w-full",type:"date",value:r.graded_at,onChange:e=>g("graded_at",e.target.value)})]}),a.jsx("div",{className:"flex justify-end gap-2",children:a.jsx($,{type:"submit",disabled:f||o===0,children:f?"Creating...":"Create Graded Item"})})]})}export{ae as default};
